---
title: "CRDT"
date: 2021-03-05T10:59:43+08:00
draft: true
tags:
    - distributed
    - data_struct
    - what
---

CRDT *(Conflict-free Replicated Data Types)* 是一种数据结构，能够在AP的情况下，提供数据的最终一致性。

对于CRDT有两种等价的描述，分别是基于状态(state-based)的和基于操作的(operation-based)。

# CRDT论文笔记

## 概念与定义

- 表示集群的集合与正确的

    定义一个有限集合，其中的元素为无拜占庭问题的进程。
    其中的进程会：
    
    1. 随机、无预警的崩溃(crash)
    1. 永久的崩溃
    1. 保留所有状态恢复

    对于没有崩溃的元素称为 **正确的** (correct)。

### 基于状态的描述

设想我们维护一个对象，
在集群上，每个进程有一个这个对象的副本。
具体的，对象是一个元组 $(S,s^0,q,u,m)$ 。

每个进程 $p_i$ 有自己的对象，和自己的状态 $s_i \in S$，
其中 $s_i$ 被称为 **载荷** (payload)。
**载荷** 的初始值是 $s^0$ 。

$q$ $u$ $m$ 是对象的**方法** (method)，
对象的用户会用 query $q$ 来查询状态，
用 update $u$ 来更新状态，
merge $m$ 用来合并两个副本。
方法都是在单个副本上执行的。

系统运行时，会通过容错的方法将所有副本上的所有更新投递给所有的副本，
一个副本在接收到其他副本的更新消息时，
通过 $merge$ 来合并。

#### 一些定义和解释

- 一个方法的所有前提被满足的状态被称为 **启用的** (enable)。一个启用的方法会在被调用时尽快执行。

- 方法的排序
    - 定义 $f^k_i(a)$ 是在副本 $i$ 上执行的第 $k$ 个方法，排序从1开始。
    - 定义 $K_i(f)$ 是方法 $f$ 在副本 $i$ 上执行的序号。

    有 $K_i($f^k_i(a)) = k$ 成立。

- 状态的变更
    - 定义 $s^k_i$ 是副本 $i$ 在第$k$个方法执行完成后的状态，特别的 $s^0_i=s^0$。

    我们将第$k$个方法在副本$i$上的执行和状态的变化表示为：
    
    $$
    s^{k-1}_i \cdot f^k_i(a) = s^k_i
    $$
- 如果两个状态对于任何查询方法调用返回相同的结果，那么称这两个状态为相等(equivalence)。





# 参考资料

- [Conflict-free Replicated Data Types](https://hal.inria.fr/hal-00932836/file/CRDTs_SSS-2011.pdf)

